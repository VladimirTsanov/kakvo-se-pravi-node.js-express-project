<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <%- include('header') %>

        <main>
            <br>
            <% errors.forEach(error=> { %>
                <p class="notice">
                    <%= error %>
                </p>
            <% }) %>

            <fieldset>
                <legend>Изпрати ни съобщение...</legend><br>
                <p>*Всички полета са задължителни!</p>

                <label for="name"><small>Вашето име:</small></label>
                <input type="text" id="name" name="name" autocomplete="off" required><br>

                <label for="email"><small>Вашия имейл:</small></label>
                <input type="email" id="email" name="email" autocomplete="off" required>
                <br />

                <label for="message"><small>Вашето съобщение:</small></label>
                <textarea type="text" id="message" name="message" autocomplete="off" required></textarea>

                <button id="sentBtn">Изпрати</button>
            </fieldset>

            <h3>Контакти: </h3>
        </main>
        <%- include('footer') %>

            <script>
                document.getElementById("sentBtn").addEventListener("click", () => {
                    const name = document.getElementById('name').value;
                    const email = document.getElementById('email').value;
                    const message = document.getElementById('message').value;

                    fetch('/feedback', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name, email, message })
                    })
                        .then(res => res.json())
                        .then(data => {
                            if (data.success) {
                                alert('Имейлът е изпратен успешно!');
                                window.location.href = '/feedback';
                            } else {
                                alert('Възникна грешка при изпращането на имейла.');
                            }
                        })
                        .catch(err => console.error(err));
                });
            </script>
</body>

</html>